Git File format
===============

Dulwichをよりよく理解するために、Gitの秘密のほとんどを説明することから始めます。


> For a better understanding of Dulwich, we'll start by explaining most of the Git secrets.


Git管理のリポジトリの「.git」フォルダーを開きます。
「ブランチ」、「フック」などのフォルダがあります。ここでは「オブジェクト」のみに関心があります。

それを開く。



> Open the ".git" folder of any Git-managed repository. You'll find folders like "branches", "hooks"... We're only interested in "objects" here. Open it.



ほとんどの場合、2つの16進数のフォルダが表示されます。  GitはSHA-1ダイジェストによってコンテンツを識別します。 これらのフォルダー内の2桁の16進数と38桁のファイルにより、Dulwichで管理するGitオブジェクトの40文字（または20バイト）のIDが形成されます。


> You'll mostly see 2 hex-digits folders. Git identifies content by its SHA-1 digest. The 2 hex-digits plus the 38 hex-digits of files inside these folders form the 40 characters (or 20 bytes) id of Git objects you'll manage in Dulwich.


最初に3つの主要なオブジェクトを調べます。


> We'll first study the three main objects:

- The Commit;

- The Tree;

- The Blob.


The Commit
----------


Gitを使用してコミットを生成するのに慣れています。 名前とメールアドレスを設定し、`git log` を使用して履歴を表示する方法を知っている。



> You're used to generate commits using Git. You have set up your name and e-mail, and you know how to see the history using ``git log``.


コミットファイルは次のようになります::

> A commit file looks like this::

```
  commit <content length><NUL>tree <tree sha>
  parent <parent sha>
  [parent <parent sha> if several parents from merges]
  author <author name> <author e-mail> <timestamp> <timezone>
  committer <author name> <author e-mail> <timestamp> <timezone>

  <commit message>
```


しかし、コミットした変更はどこにありますか？ コミットにはツリーへの参照が含まれています。

> But where are the changes you committed? The commit contains a reference to a tree.

The Tree
--------


ツリーは、ファイル情報のコレクションであり、特定の時点における単一のディレクトリの状態です。


> A tree is a collection of file information, the state of a single directory at a given point in time.


ツリーファイルは次のようになります。

> A tree file looks like this::

```
  tree <content length><NUL><file mode> <filename><NUL><item sha>...
```

そして、ツリー内のすべてのファイルに対して繰り返します。

> And repeats for every file in the tree.


ここでは、SHA-1ダイジェストはバイナリ形式であることに注意してください。


> Note that the SHA-1 digest is in binary form here.


ファイルモードは `chmod` コマンドに与えることができる8進数の引数のようなものです。 ただし、通常のファイルとディレクトリやその他のタイプを区別するための拡張形式です。


> The file mode is like the octal argument you could give to the ``chmod`` command.  Except it is in extended form to tell regular files from directories and other types.



これでファイルの参照方法はわかりましたが、実際のコンテンツはまだ見つかりません。 ここで、ブロブへの参照が入ります。


> We now know how our files are referenced but we haven't found their actual content yet. That's where the reference to a blob comes in.




The Blob
--------

blobは、バージョン管理しているファイルのコンテンツです。


> A blob is simply the content of files you are versioning.


blobファイルは次のようになります::


> A blob file looks like this::

```
  blob <content length><NUL><content>
```

単一の行を変更すると、コミット時にGitによって別のblobが生成されます。 これは、Gitがどのバージョンでもすぐにチェックアウトできる方法です。

> If you change a single line, another blob will be generated by Git at commit time. This is how Git can fastly checkout any version in time.


反対に、ファイル名が異なる複数の同一ファイルは、1つのblobのみを生成します。 これが主に、Gitでの名前変更が非常に安価で効率的な方法です。


> On the opposite, several identical files with different filenames generate only one blob. That's mostly how renames are so cheap and efficient in Git.





Dulwich Objects
---------------

DulwichはAPIを使用してこれら3つのオブジェクトを実装し、必要な情報に簡単にアクセスできるようにすると同時に、Gitが操作を高速化し、スペースを削減するために使用している秘密を抽象化します。


> Dulwich implements these three objects with an API to easily access the information you need, while abstracting some more secrets Git is using to accelerate operations and reduce space.




More About Git formats
----------------------


これらの3つのオブジェクトは、Gitリポジトリのほとんどのコンテンツを構成し、履歴に使用されます。 それらはディスク上の単純なファイル（オブジェクトごとに1つのファイル）として、またはこれらの多数のオブジェクトのコンテナーである `pack` ファイルとして表示できます。


> These three objects make up most of the contents of a Git repository and are used for the history. They can either appear as simple files on disk (one file per object) or in a ``pack`` file, which is a container for a number of these objects.


リポジトリ内の作業コピーの現在の状態のインデックスと、既存のブランチとタグを追跡するためのファイルもあります。


> There is also an index of the current state of the working copy in the repository as well as files to track the existing branches and tags.


オブジェクト形式とSHA-1ダイジェストの詳細については、以下を参照してください。

> For a more detailed explanation of object formats and SHA-1 digests, see:


[http://www-cs-students.stanford.edu/~blynn/gitmagic/ch08.html](http://www-cs-students.stanford.edu/~blynn/gitmagic/ch08.html)



Gitの最近のバージョンはzlibを使用してオブジェクトファイルを圧縮することに注意してください。

> Just note that recent versions of Git compress object files using zlib.
